name: Manual workflow

on:
  push:
jobs:
  greet:
    runs-on: ubuntu-latest
    steps:
    - name: Send greeting
      run: echo "Hello ${{ inputs.name }}"
    - name: Create issue on failed deployment
      uses: actions/github-script@v6
      env:
        title: ${{ github.event.issue.title }}
      with:
        script: |
          try {
            const { data: issue } = await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.issue.number,
              body: 'The deployment to dev failed. Please investigate and resolve the issue.',
            });
            console.log(`Created issue ${issue.html_url}`);
            core.setOutput('issue-url', issue.html_url);
            const { data: pullRequest } = await github.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number,
            });
            const issueUrl = core.getInput('issue-url');
            const comment = `The deployment to dev failed. Please see ${issueUrl} for more information.`;
            await github.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: pullRequest.number,
              body: comment,
            });
          } catch (error) {
            console.error(error);
            core.setFailed(error.message);
          }
